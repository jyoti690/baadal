{{extend 'blank-page.html'}}
<div class="modal fade" id="my-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Modal title</h4>
      </div>
      <div class="modal-body">
        <div class="panel-body">
          <form role="form" id="vm_request" name="vm_request" action="/baadal/user/post_request" method="post" class="form-horizontal">
            <div class="form-group">
              <label for="vm_name" class="col-sm-3 control-label">VM Name*</label>
              <div class="col-sm-9">
                <p class="form-control-static">email@example.com</p>
              </div>
            </div>
          
            <div class="form-group">
              <label for="template" class="col-sm-3 control-label">Template*</label>
              <div class="col-sm-9">
                <select id="template" name="template" class="form-control select" required="required">
                  <option value=""></option>
                </select>
              </div>
            </div>
          
            <div class="form-group">
              <label for="config" class="col-sm-3 control-label">Configuration*</label>
              <div class="col-sm-9">
                <select id="config" name="config" class="form-control select" required="required">
                  <option value=""></option>
                </select>
              </div>
            </div>
          
            <div class="form-group">
              <label for="sec_domain" class="col-sm-3 control-label">Security Domain*</label>
              <div class="col-sm-9">
                <select id="sec_domain" name="sec_domain" class="form-control select" required="required">
                  <option value=""></option>
                </select>
              </div>
            </div>
          
            <div class="form-group">
              <label for="storage" class="col-sm-3 control-label">Extra Storage (GB)</label>
              <div class="col-sm-9">
                <input type="number" id="storage" name="storage" class="form-control">
              </div>
            </div>
          
            <div class="form-group">
              <label for="purpose" class="col-sm-3 control-label">Purpose</label>
              <div class="col-sm-9">
                <textarea id="purpose" name="purpose" class="form-control textarea"></textarea>
              </div>
            </div>
          
            <div class="form-group">
              <label class="col-sm-3 control-label">Public IP Required</label>
              <div class="col-sm-9">
                <div class="radio radio-inline">
                  <label>
                    <input type="radio" name="public_ip" id="public_ip" value="yes">Yes
                  </label>
                </div>
                <div class="radio radio-inline">
                  <label>
                    <input type="radio" name="public_ip" id="public_ip" value="No" checked>No
                  </label>
                </div>
              </div>
            </div>
          
            <div class="form-group">
              <label for="collaborators" class="col-sm-3 control-label">Collaborators</label>
              <div class="col-sm-9">
                <input type="text" id="collaborators" name="collaborators" class="form-control">
              </div>
            </div>

            <div class="form-group">
              <div class="col-sm-9 col-sm-offset-3">
                <button class="btn btn-primary" type="submit" id="submit_request">Submit</button>
                <button class="btn btn-default" type="reset">Reset</button>
              </div>
            </div>
          </form>
        </div>
        <div class="panel-footer">
          <span style="display:none" class="text-danger" id="error-message">There was some error in the form. Please check the values and submit the form again.</span>
          <span style="display:none" class="text-success" id="success-message">Request successfully posted.</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Pending VM Requests</h3>
  </div>
  <div class="panel-body">
    <table id="requests" class="table table-striped table-condensed table-bordered table-hover">
        <thead>
            <tr>
                <th>VM Name</th>
                <th>Requested By</th>
                <th>Config</th>
                <th>Public IP</th>
                <th>Security Domain</th>
                <th>Request Time</th>
                <th>Collaborators</th>
                <th>Actions</th>
                <!--<th>Purpose</th> -->
            </tr>
        </thead>
    </table>
  </div>
  <div class="panel-footer">
    
  </div>
</div>
<script src="/baadal/static/js/jquery-2.1.4.min.js"></script>
<script src="/baadal/static/js/bootstrap.min.js"></script>
<script src="/baadal/static/js/datatables.min.js"></script>
<script src="/baadal/static/js/dataTables.bootstrap.min.js"></script>
<script src="/baadal/static/js/baadal.js"></script>
<script>
(function(){
    $('#requests').DataTable( {
        "ajax": "/baadal/admin/pending_requests.json",
        "columns": [
            { "data": "vm_name" },
            { "data": "owner" },
            { "data": "flavor" },
            { "data": "public_ip_required" },
            { "data": "sec_domain" },
            { "data": "request_time" },
            { "data": "collaborators" },
        ],
        "aoColumnDefs": [
            {
                "aTargets": [7],
                "mData": null,
                "mRender": function (data, type, full) {
                    return '<div class="btn-group" role="group" aria-label="..."> \
                            <button title="Approve" type="button" data-action="approve" class="btn btn-success btn-action" aria-label="Approve">\
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>\
                            </button> \
                            <button title="Edit" type="button" data-action="edit" class="btn btn-info btn-edit" aria-label="Edit">\
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>\
                            </button> \
                            <button title="Reject" type="button" data-action="reject" class="btn btn-danger btn-action" aria-label="Reject">\
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>\
                            </button>\
                    </div>';
                }
            },
            {"visible": false,  "targets": [ 0 ]}
        ],
        "fnCreatedRow": function( nRow, aData, iDataIndex ) {
            nRow.setAttribute('data-reqid',aData.id);
        }
    } );
    $('#requests').on('click','.btn-action', function(e) {
        var id = this.closest('tr').getAttribute('data-reqid');
        var action = this.getAttribute('data-action');
        $.ajax({
            'url': '/baadal/action/handle_request',
            'type': 'post',
            'data': {
                'id':id,
                'action': action
            },
            'success': function(response) {
                console.log(response);
            }
        });
    });
    $('#requests').on('click','.btn-edit', function(e) {
        e.preventDefault();
        console.log(e);
        $('#my-modal').modal('show');
    });
})();
</script>
{{include 'wrap.html'}}