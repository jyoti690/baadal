{{extend 'blank-page.html'}}
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Pending VM Requests</h3>
  </div>
  <div class="panel-body">
    <table id="requests" class="table table-striped table-condensed table-bordered table-hover">
        <thead>
            <tr>
                <th>VM Name</th>
                <th>Requested By</th>
                <th>Config</th>
                <th>Public IP</th>
                <th>Security Domain</th>
                <th>Request Time</th>
                <th>Collaborators</th>
                <th>Actions</th>
                <!--<th>Purpose</th> -->
            </tr>
        </thead>
    </table>
  </div>
  <div class="panel-footer">
    
  </div>
</div>
<script src="/baadal/static/js/jquery-2.1.4.min.js"></script>
<script src="/baadal/static/js/bootstrap.min.js"></script>
<script src="/baadal/static/js/datatables.min.js"></script>
<script src="/baadal/static/js/dataTables.bootstrap.min.js"></script>
<script src="/baadal/static/js/baadal.js"></script>
<script>
(function(){
    $('#requests').DataTable( {
        "ajax": "/baadal/admin/pending_requests.json",
        "columns": [
            { "data": "vm_name" },
            { "data": "owner" },
            { "data": "flavor" },
            { "data": "public_ip_required" },
            { "data": "sec_domain" },
            { "data": "request_time" },
            { "data": "collaborators" },
        ],
        "aoColumnDefs": [
            {
                "aTargets": [7],
                "mData": null,
                "mRender": function (data, type, full) {
                    return '<div class="btn-group" role="group" aria-label="..."> \
                            <button title="Approve" type="button" data-action="approve" class="btn btn-success btn-action" aria-label="Approve">\
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>\
                            </button> \
                            <button title="Edit" type="button" data-action="edit" class="btn btn-info btn-action" aria-label="Edit">\
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>\
                            </button> \
                            <button title="Reject" type="button" data-action="reject" class="btn btn-danger btn-action" aria-label="Reject">\
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>\
                            </button>\
                    </div>';
                }
            },
            {"visible": false,  "targets": [ 0 ]}
        ],
        "fnCreatedRow": function( nRow, aData, iDataIndex ) {
            nRow.setAttribute('data-reqid',aData.id);
        }
    } );
    $('#requests').on('click','.btn-action', function(e) {
        var id = this.closest('tr').getAttribute('data-reqid');
        var action = this.getAttribute('data-action');
        $.ajax({
            'url': '/baadal/action/handle_request',
            'type': 'post',
            'data': {
                'id':id,
                'action': action
            },
            'success': function(response) {
                console.log(response);
            }
        });
    });
})();
</script>
{{include 'wrap.html'}}